<!DOCTYPE html >
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBP Media - Automation Command Center</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #09090b;
            --bg-card: #18181b;
            --bg-card-hover: #27272a;
            --border: #3f3f46;
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --accent-blue: #3b82f6;
            --accent-green: #22c55e;
            --accent-yellow: #eab308;
            --accent-red: #ef4444;
            --accent-purple: #a855f7;
            --accent-cyan: #06b6d4;
            --accent-orange: #f97316;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Space Grotesk', sans-serif; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; }
        .header { background: linear-gradient(180deg, #18181b 0%, #09090b 100%); border-bottom: 1px solid var(--border); padding: 20px 32px; position: sticky; top: 0; z-index: 100; }
        .header-content { max-width: 1600px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon { width: 40px; height: 40px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .logo-text h1 { font-size: 20px; font-weight: 700; }
        .logo-text p { font-size: 12px; color: var(--text-secondary); }
        .header-right { display: flex; align-items: center; gap: 16px; }
        .status-live { display: flex; align-items: center; gap: 8px; padding: 8px 14px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 20px; font-size: 12px; font-weight: 600; color: var(--accent-green); }
        .status-dot { width: 8px; height: 8px; background: var(--accent-green); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .timestamp { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text-muted); padding: 8px 12px; background: var(--bg-card); border-radius: 6px; border: 1px solid var(--border); }
        .tab-nav { max-width: 1600px; margin: 0 auto; padding: 20px 32px 0; display: flex; gap: 4px; }
        .tab-btn { padding: 12px 24px; background: transparent; border: none; color: var(--text-secondary); font-family: 'Space Grotesk', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; border-radius: 8px 8px 0 0; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
        .tab-btn:hover { background: var(--bg-card); color: var(--text-primary); }
        .tab-btn.active { background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--border); border-bottom: 1px solid var(--bg-card); position: relative; top: 1px; }
        .main { max-width: 1600px; margin: 0 auto; padding: 0 32px 32px; }
        .tab-content { background: var(--bg-card); border: 1px solid var(--border); border-radius: 0 12px 12px 12px; padding: 24px; display: none; }
        .tab-content.active { display: block; }
        .kpi-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 24px; }
        .kpi-card { background: var(--bg-dark); border: 1px solid var(--border); border-radius: 12px; padding: 20px; position: relative; overflow: hidden; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; }
        .kpi-card.blue::before { background: var(--accent-blue); }
        .kpi-card.green::before { background: var(--accent-green); }
        .kpi-card.yellow::before { background: var(--accent-yellow); }
        .kpi-card.red::before { background: var(--accent-red); }
        .kpi-card.purple::before { background: var(--accent-purple); }
        .kpi-card.cyan::before { background: var(--accent-cyan); }
        .kpi-card.orange::before { background: var(--accent-orange); }
        .kpi-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); margin-bottom: 8px; }
        .kpi-value { font-size: 32px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .kpi-card.blue .kpi-value { color: var(--accent-blue); }
        .kpi-card.green .kpi-value { color: var(--accent-green); }
        .kpi-card.yellow .kpi-value { color: var(--accent-yellow); }
        .kpi-card.red .kpi-value { color: var(--accent-red); }
        .kpi-card.purple .kpi-value { color: var(--accent-purple); }
        .kpi-card.cyan .kpi-value { color: var(--accent-cyan); }
        .kpi-card.orange .kpi-value { color: var(--accent-orange); }
        .kpi-sub { font-size: 11px; color: var(--text-secondary); margin-top: 8px; }
        .kpi-sub.up { color: var(--accent-green); }
        .kpi-sub.down { color: var(--accent-red); }
        .section { margin-bottom: 24px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .section-title { font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .card { background: var(--bg-dark); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .card-title { font-size: 14px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .chart-container { height: 200px; position: relative; }
        .risk-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .risk-item { background: var(--bg-dark); border: 1px solid var(--border); border-radius: 10px; padding: 16px; text-align: center; }
        .risk-value { font-size: 28px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .risk-value.ok { color: var(--accent-green); }
        .risk-value.warn { color: var(--accent-yellow); }
        .risk-value.danger { color: var(--accent-red); }
        .risk-label { font-size: 11px; color: var(--text-secondary); margin-top: 4px; }
        .top-list { display: flex; flex-direction: column; gap: 8px; }
        .top-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-card); border-radius: 8px; }
        .top-rank { width: 24px; height: 24px; background: var(--accent-purple); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; margin-right: 12px; }
        .top-name { flex: 1; font-size: 13px; font-weight: 500; }
        .top-value { font-family: 'JetBrains Mono', monospace; font-size: 13px; font-weight: 600; color: var(--accent-green); }
        .alert-box { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 10px; padding: 16px; margin-bottom: 12px; }
        .alert-box.warning { background: rgba(234, 179, 8, 0.1); border-color: rgba(234, 179, 8, 0.3); }
        .alert-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .alert-title { font-size: 14px; font-weight: 600; }
        .alert-badge { font-size: 10px; padding: 3px 8px; border-radius: 4px; font-weight: 700; text-transform: uppercase; }
        .alert-badge.high { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
        .alert-badge.medium { background: rgba(234, 179, 8, 0.2); color: var(--accent-yellow); }
        .alert-desc { font-size: 12px; color: var(--text-secondary); }
        .alert-meta { display: flex; gap: 16px; margin-top: 8px; font-size: 11px; color: var(--text-muted); }
        .capacity-item { margin-bottom: 16px; }
        .capacity-header { display: flex; justify-content: space-between; margin-bottom: 6px; }
        .capacity-name { font-size: 13px; font-weight: 500; }
        .capacity-count { font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--text-secondary); }
        .capacity-bar { height: 8px; background: var(--bg-card); border-radius: 4px; overflow: hidden; }
        .capacity-fill { height: 100%; border-radius: 4px; }
        .capacity-fill.low { background: var(--accent-green); }
        .capacity-fill.medium { background: var(--accent-yellow); }
        .capacity-fill.high { background: var(--accent-orange); }
        .pipeline { display: flex; align-items: center; justify-content: space-between; padding: 20px 0; }
        .pipeline-stage { flex: 1; text-align: center; position: relative; }
        .pipeline-stage::after { content: '->'; position: absolute; right: -10px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 20px; }
        .pipeline-stage:last-child::after { display: none; }
        .pipeline-count { font-size: 36px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .pipeline-label { font-size: 11px; color: var(--text-secondary); margin-top: 4px; }
        .pipeline-stage:nth-child(1) .pipeline-count { color: var(--accent-blue); }
        .pipeline-stage:nth-child(2) .pipeline-count { color: var(--accent-yellow); }
        .pipeline-stage:nth-child(3) .pipeline-count { color: var(--accent-cyan); }
        .pipeline-stage:nth-child(4) .pipeline-count { color: var(--accent-green); }
        .api-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .api-item { background: var(--bg-card); border-radius: 10px; padding: 16px; text-align: center; }
        .api-name { font-size: 12px; font-weight: 600; margin-bottom: 12px; }
        .api-gauge { width: 80px; height: 80px; margin: 0 auto 12px; position: relative; }
        .api-gauge svg { transform: rotate(-90deg); }
        .api-gauge-bg { fill: none; stroke: var(--border); stroke-width: 8; }
        .api-gauge-fill { fill: none; stroke-width: 8; stroke-linecap: round; }
        .api-gauge-fill.healthy { stroke: var(--accent-green); }
        .api-gauge-fill.warning { stroke: var(--accent-yellow); }
        .api-gauge-fill.critical { stroke: var(--accent-red); }
        .api-percent { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 700; }
        .api-status { font-size: 10px; padding: 3px 8px; border-radius: 4px; font-weight: 600; }
        .api-status.healthy { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .api-status.warning { background: rgba(234, 179, 8, 0.15); color: var(--accent-yellow); }
        .api-status.critical { background: rgba(239, 68, 68, 0.15); color: var(--accent-red); }
        .changelog { display: flex; flex-direction: column; gap: 12px; }
        .changelog-item { display: flex; gap: 12px; padding: 12px; background: var(--bg-card); border-radius: 8px; align-items: center; }
        .changelog-date { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text-muted); }
        .changelog-type { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 600; }
        .changelog-type.enhancement { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        .changelog-type.bugfix { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .changelog-type.config { background: rgba(234, 179, 8, 0.15); color: var(--accent-yellow); }
        .changelog-content { flex: 1; }
        .changelog-auto { font-size: 13px; font-weight: 500; }
        .changelog-desc { font-size: 12px; color: var(--text-secondary); }
        .changelog-by { font-size: 11px; color: var(--text-muted); }
        .dep-map { display: flex; flex-direction: column; gap: 12px; }
        .dep-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-card); border-radius: 8px; }
        .dep-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .dep-icon.openai { background: rgba(168, 85, 247, 0.2); }
        .dep-icon.google { background: rgba(59, 130, 246, 0.2); }
        .dep-icon.rest { background: rgba(34, 197, 94, 0.2); }
        .dep-info { flex: 1; }
        .dep-name { font-size: 13px; font-weight: 600; }
        .dep-count { font-size: 11px; color: var(--text-secondary); }
        .dep-impact { font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--accent-red); }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px 16px; font-size: 11px; font-weight: 600; text-transform: uppercase; color: var(--text-muted); border-bottom: 1px solid var(--border); }
        td { padding: 14px 16px; font-size: 13px; border-bottom: 1px solid var(--border); }
        tr:hover td { background: rgba(255, 255, 255, 0.02); }
        .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .status-badge.running { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .status-badge.deployed { background: rgba(6, 182, 212, 0.15); color: var(--accent-cyan); }
        .status-badge.testing { background: rgba(234, 179, 8, 0.15); color: var(--accent-yellow); }
        .status-badge.building { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        .status-badge.hold { background: rgba(239, 68, 68, 0.15); color: var(--accent-red); }
        .status-badge.done { background: rgba(113, 113, 122, 0.15); color: var(--text-secondary); }
        .health-bar { width: 60px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; display: inline-block; margin-right: 8px; }
        .health-fill { height: 100%; border-radius: 3px; }
        .health-fill.good { background: var(--accent-green); }
        .health-fill.ok { background: var(--accent-yellow); }
        .health-fill.bad { background: var(--accent-red); }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .text-green { color: var(--accent-green); }
        .text-red { color: var(--accent-red); }
        .text-yellow { color: var(--accent-yellow); }
        .text-muted { color: var(--text-muted); }
        /* Loading Overlay */
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-dark); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .loading-overlay.hidden { display: none; }
        .loading-spinner { width: 50px; height: 50px; border: 3px solid var(--border); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 16px; color: var(--text-secondary); font-size: 14px; }
        .error-message { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--accent-red); border-radius: 8px; padding: 16px; margin: 20px; color: var(--accent-red); }
        @media (max-width: 1200px) { .kpi-row { grid-template-columns: repeat(3, 1fr); } .grid-3 { grid-template-columns: repeat(2, 1fr); } .risk-grid, .api-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .kpi-row { grid-template-columns: repeat(2, 1fr); } .grid-2, .grid-3 { grid-template-columns: 1fr; } .header-content { flex-direction: column; gap: 16px; } }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading data from Google Sheets...</div>
    </div>

    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">&#9889;</div>
                <div class="logo-text">
                    <h1>Automation Command Center</h1>
                    <p>TBP Media - n8n Workflow Management</p>
                </div>
            </div>
            <div class="header-right">
                <div class="status-live" id="statusIndicator"><span class="status-dot"></span> <span id="statusText">Loading...</span></div>
                <div class="timestamp" id="timestamp"></div>
            </div>
        </div>
    </header>
    <nav class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('founder')"><span>&#128202;</span> Founder View</button>
        <button class="tab-btn" onclick="switchTab('manager')"><span>&#9881;</span> Manager View</button>
        <button class="tab-btn" onclick="switchTab('builder')"><span>&#128295;</span> Builder View</button>
    </nav>
    <main class="main">
        <!-- FOUNDER TAB -->
        <div id="founder" class="tab-content active">
            <div class="kpi-row" id="founderKpis">
                <div class="kpi-card green"><div class="kpi-label">Monthly Cost</div><div class="kpi-value" id="kpiMonthlyCost">$0</div><div class="kpi-sub" id="kpiAutomationCount">Loading...</div></div>
                <div class="kpi-card blue"><div class="kpi-label">Monthly Value</div><div class="kpi-value" id="kpiMonthlyValue">$0</div><div class="kpi-sub up">Time saved x hourly rate</div></div>
                <div class="kpi-card purple"><div class="kpi-label">Net Savings</div><div class="kpi-value" id="kpiNetSavings">$0</div><div class="kpi-sub up">Value minus cost</div></div>
                <div class="kpi-card cyan"><div class="kpi-label">Overall ROI</div><div class="kpi-value" id="kpiRoi">0%</div><div class="kpi-sub up" id="kpiRoiSub">Calculating...</div></div>
                <div class="kpi-card orange"><div class="kpi-label">Time Saved</div><div class="kpi-value" id="kpiTimeSaved">0h</div><div class="kpi-sub">Per month</div></div>
            </div>
            <div class="section">
                <div class="section-header"><div class="section-title">&#128680; Risk Indicators</div></div>
                <div class="risk-grid" id="riskGrid">
                    <div class="risk-item"><div class="risk-value ok" id="riskCritical">0</div><div class="risk-label">Critical Down</div></div>
                    <div class="risk-item"><div class="risk-value ok" id="riskNoBackup">0</div><div class="risk-label">No Backup Owner</div></div>
                    <div class="risk-item"><div class="risk-value warn" id="riskOpenIssues">0</div><div class="risk-label">Open Issues</div></div>
                    <div class="risk-item"><div class="risk-value warn" id="riskApiQuota">0</div><div class="risk-label">API Quota Risk</div></div>
                </div>
            </div>
            <div class="grid-2 section">
                <div class="card"><div class="card-title">&#128200; Status Distribution</div><div class="chart-container"><canvas id="founderStatusChart"></canvas></div></div>
                <div class="card"><div class="card-title">&#128176; Cost by Category</div><div class="chart-container"><canvas id="founderCostChart"></canvas></div></div>
            </div>
            <div class="grid-2 section">
                <div class="card"><div class="card-title">&#127942; Top 5 by ROI</div><div class="top-list" id="topRoiList"></div></div>
                <div class="card"><div class="card-title">&#128184; Top 5 by Cost</div><div class="top-list" id="topCostList"></div></div>
            </div>
            <div class="card section"><div class="card-title">&#128101; Automations by Owner</div><div class="chart-container" style="height:250px"><canvas id="founderOwnerChart"></canvas></div></div>
        </div>
        <!-- MANAGER TAB -->
        <div id="manager" class="tab-content">
            <div class="kpi-row" id="managerKpis">
                <div class="kpi-card green"><div class="kpi-label">Overall Health</div><div class="kpi-value" id="kpiHealth">0%</div><div class="kpi-sub up">Success rate</div></div>
                <div class="kpi-card blue"><div class="kpi-label">Executions Today</div><div class="kpi-value" id="kpiExecToday">0</div><div class="kpi-sub">Across active automations</div></div>
                <div class="kpi-card red"><div class="kpi-label">Failures Today</div><div class="kpi-value" id="kpiFailures">0</div><div class="kpi-sub down" id="kpiFailureRate">0% failure rate</div></div>
                <div class="kpi-card purple"><div class="kpi-label">Active Now</div><div class="kpi-value" id="kpiActive">0</div><div class="kpi-sub">Running + Deployed</div></div>
                <div class="kpi-card yellow"><div class="kpi-label">In Pipeline</div><div class="kpi-value" id="kpiPipeline">0</div><div class="kpi-sub">Testing + Building</div></div>
            </div>
            <div class="card section"><div class="card-title">&#128260; Automation Pipeline</div>
                <div class="pipeline" id="pipelineStages">
                    <div class="pipeline-stage"><div class="pipeline-count" id="pipeBuilding">0</div><div class="pipeline-label">Building</div></div>
                    <div class="pipeline-stage"><div class="pipeline-count" id="pipeTesting">0</div><div class="pipeline-label">Testing</div></div>
                    <div class="pipeline-stage"><div class="pipeline-count" id="pipeDeployed">0</div><div class="pipeline-label">Deployed</div></div>
                    <div class="pipeline-stage"><div class="pipeline-count" id="pipeRunning">0</div><div class="pipeline-label">Running</div></div>
                </div>
            </div>
            <div class="grid-2 section">
                <div class="card"><div class="card-title">&#128680; Needs Attention Now</div><div id="alertsContainer"></div></div>
                <div class="card"><div class="card-title">&#128202; Team Capacity</div><div id="capacityContainer"></div></div>
            </div>
            <div class="card section"><div class="card-title">&#128203; All Automations Status</div><table id="managerTable"><thead><tr><th>Automation</th><th>Status</th><th>Health</th><th>Last Run</th><th>Today</th><th>Success %</th><th>Owner</th><th>Backup</th></tr></thead><tbody></tbody></table></div>
        </div>
        <!-- BUILDER TAB -->
        <div id="builder" class="tab-content">
            <div class="kpi-row" id="builderKpis">
                <div class="kpi-card blue"><div class="kpi-label">Total Nodes</div><div class="kpi-value" id="kpiNodes">0</div><div class="kpi-sub">Across all workflows</div></div>
                <div class="kpi-card green"><div class="kpi-label">Avg Exec Time</div><div class="kpi-value" id="kpiAvgTime">0s</div><div class="kpi-sub">Per automation</div></div>
                <div class="kpi-card yellow"><div class="kpi-label">APIs Connected</div><div class="kpi-value" id="kpiApis">0</div><div class="kpi-sub">External services</div></div>
                <div class="kpi-card purple"><div class="kpi-label">Documented</div><div class="kpi-value" id="kpiDocs">0</div><div class="kpi-sub">Complete docs</div></div>
                <div class="kpi-card red"><div class="kpi-label">Errors Today</div><div class="kpi-value" id="kpiErrors">0</div><div class="kpi-sub">Needs attention</div></div>
            </div>
            <div class="section"><div class="section-header"><div class="section-title">&#128202; API Quota Usage</div></div>
                <div class="api-grid" id="apiQuotaGrid">
                    <div class="api-item"><div class="api-name">OpenAI</div><div class="api-gauge"><svg viewBox="0 0 100 100"><circle class="api-gauge-bg" cx="50" cy="50" r="40"></circle><circle class="api-gauge-fill warning" cx="50" cy="50" r="40" stroke-dasharray="251.2" stroke-dashoffset="83"></circle></svg><span class="api-percent">67%</span></div><span class="api-status warning">Warning</span></div>
                    <div class="api-item"><div class="api-name">Google Cloud</div><div class="api-gauge"><svg viewBox="0 0 100 100"><circle class="api-gauge-bg" cx="50" cy="50" r="40"></circle><circle class="api-gauge-fill healthy" cx="50" cy="50" r="40" stroke-dasharray="251.2" stroke-dashoffset="193"></circle></svg><span class="api-percent">23%</span></div><span class="api-status healthy">Healthy</span></div>
                    <div class="api-item"><div class="api-name">Apify</div><div class="api-gauge"><svg viewBox="0 0 100 100"><circle class="api-gauge-bg" cx="50" cy="50" r="40"></circle><circle class="api-gauge-fill critical" cx="50" cy="50" r="40" stroke-dasharray="251.2" stroke-dashoffset="28"></circle></svg><span class="api-percent">89%</span></div><span class="api-status critical">Critical</span></div>
                    <div class="api-item"><div class="api-name">Rapid API</div><div class="api-gauge"><svg viewBox="0 0 100 100"><circle class="api-gauge-bg" cx="50" cy="50" r="40"></circle><circle class="api-gauge-fill healthy" cx="50" cy="50" r="40" stroke-dasharray="251.2" stroke-dashoffset="128"></circle></svg><span class="api-percent">49%</span></div><span class="api-status healthy">Healthy</span></div>
                </div>
            </div>
            <div class="grid-2 section">
                <div class="card"><div class="card-title">&#128279; Dependency Impact Map</div><div class="dep-map" id="dependencyMap"></div></div>
                <div class="card"><div class="card-title">&#128221; Recent Changes</div><div class="changelog" id="changelogContainer"></div></div>
            </div>
            <div class="grid-2 section">
                <div class="card"><div class="card-title">&#9889; Performance Leaderboard</div><div class="top-list" id="performanceList"></div></div>
                <div class="card"><div class="card-title">&#128308; Error Analysis (Last 30 Days)</div><div class="chart-container"><canvas id="builderErrorChart"></canvas></div></div>
            </div>
            <div class="card section"><div class="card-title">&#128295; Technical Details</div><table id="builderTable"><thead><tr><th>Automation</th><th>Trigger</th><th>Schedule</th><th>Primary API</th><th>Nodes</th><th>Avg Time</th><th>Docs</th><th>n8n Link</th></tr></thead><tbody></tbody></table></div>
        </div>
    </main>

    <script>
        // ============================================
        // CONFIGURATION - UPDATE THESE VALUES
        // ============================================
        const CONFIG = {
            // Your Google Sheet ID (from the URL)
            SHEET_ID: '1ih_9iyfWNQXtXbAQBKxivwg05lT_U2fH068wsY_PG3I',

            // Your Google API Key
            API_KEY: 'AIzaSyDiIA75Y8N10JpR0J5jeSy-se4WGtldV4Q',

            // Sheet name for main automation data
            MAIN_SHEET: 'Master Registry',

            // Sheet name for issues (optional)
            ISSUES_SHEET: 'Issues',

            // Sheet name for changelog (optional)
            CHANGELOG_SHEET: 'Change Log',

            // Auto-refresh interval in milliseconds (1 minutes = 60000)
            REFRESH_INTERVAL: 60000,

            // Your n8n base URL
            N8N_BASE_URL: 'https://n8n.tbpmedia.io/workflow/'
        };

        // ============================================
        // COLUMN MAPPING (0-indexed based on your Excel)
        // ============================================
        const COLUMNS = {
            ID: 0,
            NAME: 1,
            WORKFLOW_ID: 2,
            URL: 3,
            CATEGORY: 4,
            DEPARTMENT: 5,
            STATUS: 6,
            PRIORITY: 7,
            BUSINESS_IMPACT: 8,
            COMPLEXITY: 9,
            HEALTH: 10,
            OWNER: 11,
            BACKUP: 12,
            REQUESTER: 13,
            CREATED: 14,
            GO_LIVE: 15,
            LAST_MODIFIED: 16,
            NEXT_REVIEW: 17,
            LAST_RUN: 18,
            EXEC_TODAY: 19,
            EXEC_WEEK: 20,
            EXEC_MONTH: 21,
            SUCCESS_RATE: 22,
            AVG_TIME: 23,
            PEAK_TIME: 24,
            COST_TYPE: 25,
            COST_UNIT: 26,
            MONTHLY_COST: 27,
            TIME_SAVED: 28,
            VALUE: 29,
            ROI: 30,
            TRIGGER: 31,
            SCHEDULE: 32,
            PRIMARY_API: 33,
            NODES: 34,
            DOC_STATUS: 35,
            VIDEO: 36,
            GUMROAD: 37,
            PRICE: 38,
            OPEN_ISSUES: 39,
            FEEDBACK: 40
        };

        // Global data storage
        let automations = [];
        let issues = [];
        let changelog = [];
        let charts = {};

        // ============================================
        // FETCH DATA FROM GOOGLE SHEETS
        // ============================================
        async function fetchSheetData(sheetName, range = '') {
            const rangeParam = range || `${sheetName}!A:AZ`;
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/${encodeURIComponent(rangeParam)}?key=${CONFIG.API_KEY}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data.values || [];
            } catch (error) {
                console.error(`Error fetching ${sheetName}:`, error);
                throw error;
            }
        }

        async function loadAllData() {
            try {
                showLoading(true);

                // Fetch main automation data
                const mainData = await fetchSheetData(CONFIG.MAIN_SHEET);

                if (mainData.length < 2) {
                    throw new Error('No data found in sheet');
                }

                // Parse automation data (skip header row)
                automations = mainData.slice(1).map(row => ({
                    id: row[COLUMNS.ID] || '',
                    name: row[COLUMNS.NAME] || '',
                    workflowId: row[COLUMNS.WORKFLOW_ID] || '',
                    url: row[COLUMNS.URL] || '',
                    category: row[COLUMNS.CATEGORY] || '',
                    department: row[COLUMNS.DEPARTMENT] || '',
                    status: row[COLUMNS.STATUS] || '',
                    priority: row[COLUMNS.PRIORITY] || '',
                    businessImpact: parseFloat(row[COLUMNS.BUSINESS_IMPACT]) || 0,
                    complexity: row[COLUMNS.COMPLEXITY] || '',
                    health: parseFloat(row[COLUMNS.HEALTH]) || 0,
                    owner: row[COLUMNS.OWNER] || '',
                    backup: row[COLUMNS.BACKUP] || '',
                    requester: row[COLUMNS.REQUESTER] || '',
                    created: row[COLUMNS.CREATED] || '',
                    goLive: row[COLUMNS.GO_LIVE] || '',
                    lastModified: row[COLUMNS.LAST_MODIFIED] || '',
                    nextReview: row[COLUMNS.NEXT_REVIEW] || '',
                    lastRun: row[COLUMNS.LAST_RUN] || '',
                    execToday: parseInt(row[COLUMNS.EXEC_TODAY]) || 0,
                    execWeek: parseInt(row[COLUMNS.EXEC_WEEK]) || 0,
                    execMonth: parseInt(row[COLUMNS.EXEC_MONTH]) || 0,
                    successRate: parseFloat(row[COLUMNS.SUCCESS_RATE]) || 0,
                    avgTime: parseFloat(row[COLUMNS.AVG_TIME]) || 0,
                    peakTime: parseFloat(row[COLUMNS.PEAK_TIME]) || 0,
                    costType: row[COLUMNS.COST_TYPE] || '',
                    costUnit: parseFloat(row[COLUMNS.COST_UNIT]) || 0,
                    monthlyCost: parseFloat(row[COLUMNS.MONTHLY_COST]) || 0,
                    timeSaved: parseFloat(row[COLUMNS.TIME_SAVED]) || 0,
                    value: parseFloat(row[COLUMNS.VALUE]) || 0,
                    roi: parseFloat(row[COLUMNS.ROI]) || 0,
                    trigger: row[COLUMNS.TRIGGER] || '',
                    schedule: row[COLUMNS.SCHEDULE] || '',
                    api: row[COLUMNS.PRIMARY_API] || '',
                    nodes: parseInt(row[COLUMNS.NODES]) || 0,
                    docs: row[COLUMNS.DOC_STATUS] || '',
                    video: row[COLUMNS.VIDEO] || '',
                    gumroad: row[COLUMNS.GUMROAD] || '',
                    price: parseFloat(row[COLUMNS.PRICE]) || 0,
                    openIssues: parseInt(row[COLUMNS.OPEN_ISSUES]) || 0,
                    feedback: row[COLUMNS.FEEDBACK] || ''
                })).filter(a => a.name); // Filter out empty rows

                console.log(`Loaded ${automations.length} automations`);

                // Initialize dashboard
                initializeDashboard();
                showLoading(false);
                updateStatus('All Systems Operational', true);

            } catch (error) {
                console.error('Failed to load data:', error);
                showLoading(false);
                updateStatus('Data Load Failed', false);
                showError(error.message);
            }
        }

        // ============================================
        // UI HELPERS
        // ============================================
        function showLoading(show) {
            document.getElementById('loadingOverlay').classList.toggle('hidden', !show);
        }

        function updateStatus(text, isOk) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            statusText.textContent = text;

            if (isOk) {
                indicator.style.background = 'rgba(34, 197, 94, 0.1)';
                indicator.style.borderColor = 'rgba(34, 197, 94, 0.3)';
                indicator.style.color = 'var(--accent-green)';
            } else {
                indicator.style.background = 'rgba(239, 68, 68, 0.1)';
                indicator.style.borderColor = 'rgba(239, 68, 68, 0.3)';
                indicator.style.color = 'var(--accent-red)';
            }
        }

        function showError(message) {
            const main = document.querySelector('.main');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `<strong>Error loading data:</strong> ${message}<br><br>
                <strong>Checklist:</strong><br>
                1. Make sure SHEET_ID is correct<br>
                2. Make sure API_KEY is correct<br>
                3. Make sure Google Sheets API is enabled<br>
                4. Make sure sheet is shared (Anyone with link can view)`;
            main.insertBefore(errorDiv, main.firstChild);
        }

        function updateTimestamp() {
            document.getElementById('timestamp').textContent = new Date().toLocaleString('en-IN', {
                day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'
            });
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.closest('.tab-btn').classList.add('active');
        }

        // ============================================
        // INITIALIZE DASHBOARD
        // ============================================
        function initializeDashboard() {
            updateTimestamp();
            setInterval(updateTimestamp, 60000);

            // Calculate and display all metrics
            updateFounderView();
            updateManagerView();
            updateBuilderView();

            // Initialize charts
            initCharts();

            // Populate tables
            populateManagerTable();
            populateBuilderTable();
        }

        // ============================================
        // FOUNDER VIEW
        // ============================================
        function updateFounderView() {
            const totalCost = automations.reduce((sum, a) => sum + a.monthlyCost, 0);
            const totalValue = automations.reduce((sum, a) => sum + a.value, 0);
            const totalTimeSaved = automations.reduce((sum, a) => sum + a.timeSaved, 0);
            const netSavings = totalValue - totalCost;
            const overallRoi = totalCost > 0 ? ((totalValue - totalCost) / totalCost * 100) : 0;

            document.getElementById('kpiMonthlyCost').textContent = '$' + totalCost.toFixed(0);
            document.getElementById('kpiMonthlyValue').textContent = '$' + totalValue.toLocaleString();
            document.getElementById('kpiNetSavings').textContent = '$' + netSavings.toLocaleString();
            document.getElementById('kpiRoi').textContent = overallRoi.toFixed(0) + '%';
            document.getElementById('kpiRoiSub').textContent = (overallRoi / 100).toFixed(0) + 'x return';
            document.getElementById('kpiTimeSaved').textContent = totalTimeSaved.toFixed(0) + 'h';
            document.getElementById('kpiAutomationCount').textContent = `Across ${automations.length} automations`;

            // Risk indicators
            const criticalDown = automations.filter(a => a.status === 'Running' && a.health < 50).length;
            const noBackup = automations.filter(a => !a.backup || a.backup.trim() === '').length;
            const openIssues = automations.reduce((sum, a) => sum + a.openIssues, 0);

            document.getElementById('riskCritical').textContent = criticalDown;
            document.getElementById('riskCritical').className = 'risk-value ' + (criticalDown === 0 ? 'ok' : 'danger');
            document.getElementById('riskNoBackup').textContent = noBackup;
            document.getElementById('riskNoBackup').className = 'risk-value ' + (noBackup === 0 ? 'ok' : 'warn');
            document.getElementById('riskOpenIssues').textContent = openIssues;
            document.getElementById('riskOpenIssues').className = 'risk-value ' + (openIssues === 0 ? 'ok' : 'warn');

            // Top 5 by ROI
            const topRoi = [...automations]
                .filter(a => a.status === 'Running' || a.status === 'Deployed')
                .sort((a, b) => b.roi - a.roi)
                .slice(0, 5);

            const topRoiList = document.getElementById('topRoiList');
            topRoiList.innerHTML = topRoi.map((a, i) => `
                <div class="top-item">
                    <span class="top-rank">${i + 1}</span>
                    <span class="top-name">${a.name}</span>
                    <span class="top-value">${a.roi === 999 ? 'âˆž (Free)' : a.roi.toFixed(0) + '%'}</span>
                </div>
            `).join('');

            // Top 5 by Cost
            const topCost = [...automations]
                .sort((a, b) => b.monthlyCost - a.monthlyCost)
                .slice(0, 5);

            const topCostList = document.getElementById('topCostList');
            topCostList.innerHTML = topCost.map((a, i) => `
                <div class="top-item">
                    <span class="top-rank">${i + 1}</span>
                    <span class="top-name">${a.name}</span>
                    <span class="top-value ${a.monthlyCost > 50 ? 'text-red' : a.monthlyCost > 10 ? 'text-yellow' : ''}">
                        ${a.status === 'HOLD' ? '$0 (HOLD)' : '$' + a.monthlyCost.toFixed(2) + '/mo'}
                    </span>
                </div>
            `).join('');
        }

        // ============================================
        // MANAGER VIEW
        // ============================================
        function updateManagerView() {
            const activeAutomations = automations.filter(a => a.status === 'Running' || a.status === 'Deployed');
            const totalExecToday = automations.reduce((sum, a) => sum + a.execToday, 0);
            const avgSuccessRate = activeAutomations.length > 0
                ? activeAutomations.reduce((sum, a) => sum + a.successRate, 0) / activeAutomations.length
                : 0;
            const failureRate = 100 - avgSuccessRate;
            const failures = Math.round(totalExecToday * (failureRate / 100));

            const statusCounts = {
                Running: automations.filter(a => a.status === 'Running').length,
                Deployed: automations.filter(a => a.status === 'Deployed').length,
                Testing: automations.filter(a => a.status === 'Testing').length,
                Building: automations.filter(a => a.status === 'Building').length,
                HOLD: automations.filter(a => a.status === 'HOLD').length,
                Done: automations.filter(a => a.status === 'Done').length
            };

            document.getElementById('kpiHealth').textContent = avgSuccessRate.toFixed(1) + '%';
            document.getElementById('kpiExecToday').textContent = totalExecToday.toLocaleString();
            document.getElementById('kpiFailures').textContent = failures;
            document.getElementById('kpiFailureRate').textContent = failureRate.toFixed(1) + '% failure rate';
            document.getElementById('kpiActive').textContent = statusCounts.Running + statusCounts.Deployed;
            document.getElementById('kpiPipeline').textContent = statusCounts.Testing + statusCounts.Building;

            // Pipeline stages
            document.getElementById('pipeBuilding').textContent = statusCounts.Building;
            document.getElementById('pipeTesting').textContent = statusCounts.Testing;
            document.getElementById('pipeDeployed').textContent = statusCounts.Deployed;
            document.getElementById('pipeRunning').textContent = statusCounts.Running;

            // Alerts - automations with issues or low health
            const needsAttention = automations.filter(a =>
                (a.status === 'Running' && a.health < 80) ||
                a.openIssues > 0 ||
                (a.feedback && a.feedback.toLowerCase().includes('fix'))
            ).slice(0, 3);

            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = needsAttention.map(a => `
                <div class="alert-box ${a.health < 70 ? '' : 'warning'}">
                    <div class="alert-header">
                        <div class="alert-title">${a.name}</div>
                        <span class="alert-badge ${a.health < 70 ? 'high' : 'medium'}">${a.health < 70 ? 'High' : 'Medium'}</span>
                    </div>
                    <div class="alert-desc">${a.feedback || 'Health below threshold - needs review'}</div>
                    <div class="alert-meta">
                        <span>Owner: ${a.owner}</span>
                        <span>Health: ${a.health}%</span>
                    </div>
                </div>
            `).join('') || '<p class="text-muted">No alerts at this time</p>';

            // Team capacity
            const ownerCounts = {};
            automations.forEach(a => {
                if (a.owner) {
                    ownerCounts[a.owner] = (ownerCounts[a.owner] || 0) + 1;
                }
            });

            const sortedOwners = Object.entries(ownerCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const maxCount = Math.max(...sortedOwners.map(o => o[1]));

            const capacityContainer = document.getElementById('capacityContainer');
            capacityContainer.innerHTML = sortedOwners.map(([owner, count]) => {
                const percent = (count / maxCount) * 100;
                const fillClass = percent > 60 ? 'high' : percent > 30 ? 'medium' : 'low';
                return `
                    <div class="capacity-item">
                        <div class="capacity-header">
                            <span class="capacity-name">${owner}</span>
                            <span class="capacity-count">${count} automations</span>
                        </div>
                        <div class="capacity-bar">
                            <div class="capacity-fill ${fillClass}" style="width:${percent}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ============================================
        // BUILDER VIEW
        // ============================================
        function updateBuilderView() {
            const totalNodes = automations.reduce((sum, a) => sum + a.nodes, 0);
            const activeAutomations = automations.filter(a => a.avgTime > 0);
            const avgTime = activeAutomations.length > 0
                ? activeAutomations.reduce((sum, a) => sum + a.avgTime, 0) / activeAutomations.length
                : 0;
            const uniqueApis = new Set(automations.map(a => a.api).filter(a => a)).size;
            const documented = automations.filter(a => a.docs === 'Complete').length;
            const totalExecToday = automations.reduce((sum, a) => sum + a.execToday, 0);
            const avgSuccessRate = activeAutomations.length > 0
                ? activeAutomations.reduce((sum, a) => sum + a.successRate, 0) / activeAutomations.length
                : 100;
            const errors = Math.round(totalExecToday * ((100 - avgSuccessRate) / 100));

            document.getElementById('kpiNodes').textContent = totalNodes;
            document.getElementById('kpiAvgTime').textContent = avgTime.toFixed(1) + 's';
            document.getElementById('kpiApis').textContent = uniqueApis;
            document.getElementById('kpiDocs').textContent = documented;
            document.getElementById('kpiErrors').textContent = errors;

            // Dependency map
            const apiDeps = {};
            automations.forEach(a => {
                if (a.api && (a.status === 'Running' || a.status === 'Deployed')) {
                    apiDeps[a.api] = (apiDeps[a.api] || 0) + 1;
                }
            });

            const dependencyMap = document.getElementById('dependencyMap');
            dependencyMap.innerHTML = Object.entries(apiDeps)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 4)
                .map(([api, count]) => {
                    const iconClass = api.toLowerCase().includes('openai') ? 'openai' :
                                     api.toLowerCase().includes('google') ? 'google' : 'rest';
                    const icon = api.toLowerCase().includes('openai') ? '&#129302;' :
                                api.toLowerCase().includes('google') ? '&#9729;' : '&#128268;';
                    return `
                        <div class="dep-item">
                            <div class="dep-icon ${iconClass}">${icon}</div>
                            <div class="dep-info">
                                <div class="dep-name">${api}</div>
                                <div class="dep-count">${count} automations depend on this</div>
                            </div>
                            <div class="dep-impact">If down -> ${count} break</div>
                        </div>
                    `;
                }).join('');

            // Performance leaderboard
            const runningAutomations = automations.filter(a => a.status === 'Running' && a.avgTime > 0);
            const fastest = [...runningAutomations].sort((a, b) => a.avgTime - b.avgTime)[0];
            const slowest = [...runningAutomations].sort((a, b) => b.avgTime - a.avgTime)[0];

            const performanceList = document.getElementById('performanceList');
            performanceList.innerHTML = `
                ${fastest ? `<div class="top-item"><span class="top-rank" style="background:var(--accent-green)">&#127942;</span><span class="top-name">Fastest: ${fastest.name}</span><span class="top-value">${fastest.avgTime.toFixed(1)}s avg</span></div>` : ''}
                ${slowest ? `<div class="top-item"><span class="top-rank" style="background:var(--accent-red)">&#128034;</span><span class="top-name">Slowest: ${slowest.name}</span><span class="top-value text-red">${slowest.avgTime.toFixed(1)}s avg</span></div>` : ''}
            `;
        }

        // ============================================
        // CHARTS
        // ============================================
        function initCharts() {
            Chart.defaults.color = '#a1a1aa';
            Chart.defaults.font.family = "'Space Grotesk', sans-serif";

            // Status distribution chart
            const statusCounts = {
                Running: automations.filter(a => a.status === 'Running').length,
                Deployed: automations.filter(a => a.status === 'Deployed').length,
                Testing: automations.filter(a => a.status === 'Testing').length,
                Building: automations.filter(a => a.status === 'Building').length,
                HOLD: automations.filter(a => a.status === 'HOLD').length,
                Done: automations.filter(a => a.status === 'Done').length
            };

            if (charts.statusChart) charts.statusChart.destroy();
            charts.statusChart = new Chart(document.getElementById('founderStatusChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusCounts),
                    datasets: [{
                        data: Object.values(statusCounts),
                        backgroundColor: ['#22c55e', '#06b6d4', '#eab308', '#3b82f6', '#ef4444', '#71717a'],
                        borderWidth: 0,
                        spacing: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: { legend: { position: 'right', labels: { boxWidth: 12, padding: 10, font: { size: 11 } } } }
                }
            });

            // Cost by category chart
            const categoryCosts = {};
            automations.forEach(a => {
                const cat = a.category || 'Other';
                categoryCosts[cat] = (categoryCosts[cat] || 0) + a.monthlyCost;
            });

            const sortedCategories = Object.entries(categoryCosts).sort((a, b) => b[1] - a[1]).slice(0, 6);

            if (charts.costChart) charts.costChart.destroy();
            charts.costChart = new Chart(document.getElementById('founderCostChart'), {
                type: 'bar',
                data: {
                    labels: sortedCategories.map(c => c[0].substring(0, 10)),
                    datasets: [{
                        data: sortedCategories.map(c => c[1]),
                        backgroundColor: ['#a855f7', '#ec4899', '#f97316', '#3b82f6', '#06b6d4', '#22c55e'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: '#3f3f46' }, ticks: { callback: v => '$' + v } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // Owner chart
            const ownerCounts = {};
            automations.forEach(a => {
                if (a.owner) {
                    ownerCounts[a.owner] = (ownerCounts[a.owner] || 0) + 1;
                }
            });

            const sortedOwners = Object.entries(ownerCounts).sort((a, b) => b[1] - a[1]).slice(0, 6);

            if (charts.ownerChart) charts.ownerChart.destroy();
            charts.ownerChart = new Chart(document.getElementById('founderOwnerChart'), {
                type: 'bar',
                data: {
                    labels: sortedOwners.map(o => o[0]),
                    datasets: [{
                        label: 'Automations',
                        data: sortedOwners.map(o => o[1]),
                        backgroundColor: '#3b82f6',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#3f3f46' } },
                        y: { grid: { display: false } }
                    }
                }
            });

            // Error chart
            if (charts.errorChart) charts.errorChart.destroy();
            charts.errorChart = new Chart(document.getElementById('builderErrorChart'), {
                type: 'doughnut',
                data: {
                    labels: ['API Timeout', 'Rate Limit', 'Auth Failed', 'Data Error', 'Network'],
                    datasets: [{
                        data: [45, 32, 18, 24, 14],
                        backgroundColor: ['#ef4444', '#f97316', '#eab308', '#a855f7', '#3b82f6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '50%',
                    plugins: { legend: { position: 'right', labels: { boxWidth: 10, padding: 8, font: { size: 10 } } } }
                }
            });
        }

        // ============================================
        // TABLES
        // ============================================
        function populateManagerTable() {
            const tbody = document.querySelector('#managerTable tbody');
            tbody.innerHTML = '';

            automations.forEach(a => {
                const statusClass = a.status.toLowerCase().replace(' ', '');
                const healthClass = a.health >= 80 ? 'good' : a.health >= 60 ? 'ok' : 'bad';
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${a.name}</strong></td>
                    <td><span class="status-badge ${statusClass}">&#9679; ${a.status}</span></td>
                    <td>
                        <div class="health-bar"><div class="health-fill ${healthClass}" style="width:${a.health}%"></div></div>
                        <span class="mono" style="font-size:11px;color:var(--text-muted)">${a.health}%</span>
                    </td>
                    <td class="mono text-muted" style="font-size:11px">${a.lastRun || '-'}</td>
                    <td class="mono">${a.execToday}</td>
                    <td class="mono ${a.successRate >= 95 ? 'text-green' : a.successRate >= 85 ? 'text-yellow' : 'text-red'}">${a.successRate}%</td>
                    <td>${a.owner}</td>
                    <td class="text-muted">${a.backup || '-'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateBuilderTable() {
            const tbody = document.querySelector('#builderTable tbody');
            tbody.innerHTML = '';

            automations.forEach(a => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${a.name}</strong></td>
                    <td>${a.trigger}</td>
                    <td class="text-muted">${a.schedule || '-'}</td>
                    <td>${a.api}</td>
                    <td class="mono">${a.nodes}</td>
                    <td class="mono">${a.avgTime}s</td>
                    <td><span class="${a.docs === 'Complete' ? 'text-green' : a.docs === 'Partial' ? 'text-yellow' : 'text-muted'}">${a.docs || 'None'}</span></td>
                    <td><a href="${a.url || CONFIG.N8N_BASE_URL + a.workflowId}" target="_blank" style="color:var(--accent-blue)">Open &#8594;</a></td>
                `;
                tbody.appendChild(row);
            });
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            loadAllData();

            // Auto-refresh
            setInterval(() => {
                console.log('Auto-refreshing data...');
                loadAllData();
            }, CONFIG.REFRESH_INTERVAL);
        });
    </script>
</body>
</html>
